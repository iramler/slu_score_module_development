---
title: "tennis-testing"
author: "eric seltzer"
format: html
---

```{r}
library(tidyverse)
library(ggplot2)
library(broom)
library(modelr)
```

```{r}
atp <- read_csv(here::here("esselt21/tennis_module/data_repo/new_atp.csv"))
```

```{r}
# filtering data to only include people who are represented in all three surfaces
names <-
  atp |>
  group_by(Player) |>
  summarise(n = n()) |>
  filter(n == 3) |>
  pull(Player)

atp <-
  atp |>
  filter(Surface != "All") |>
  filter(Player %in% names)
```

```{r}
# check win percentage distribution, what is the shape, center, and spread, is there a a big difference between the three surfaces?
atp |>
  ggplot(aes(x = WinPercentage)) +
  geom_histogram(colour = "black",
                 fill = "lightblue",
                 bins = 13,
                 aes(y=..density..)) +
  theme_minimal() +
  labs(x = "Win Percentage",
       title = "Histogram of Win Percentages by Surface",
       y = "Density",
       caption = "ATP") +
  facet_grid(~Surface,
             scales = "free") +
  theme(
    axis.text.x = element_text(angle = 45,
                                   hjust = 1,
                                   vjust = 1),
    plot.title = element_text(hjust = .5),
    plot.caption = element_text(face = "bold",
                                size = 20)
  )

wta |>
  ggplot(aes(x = WinPercentage)) +
  geom_histogram(colour = "black",
                 fill = "lightblue",
                 bins = 13,
                 aes(y=..density..)) +
  theme_minimal() +
  labs(x = "Win Percentage",
       title = "Histogram of Win Percentages by Surface",
       y = "Density",
       caption = "WTA") +
  facet_grid(~Surface,
             scales = "free") +
  theme(
    axis.text.x = element_text(angle = 45,
                                   hjust = 1,
                                   vjust = 1),
    plot.title = element_text(hjust = .5),
    plot.caption = element_text(face = "bold",
                                size = 20)
  )
```

```{r}
# five number summary and standard deviation
cWPercentage <-
  atp |>
  filter(Surface == 'Clay') |>
  pull(WinPercentage)

hWPercentage <-
  atp |>
  filter(Surface == 'Hard') |>
  pull(WinPercentage)

gWPercentage <-
  atp |>
  filter(Surface == 'Grass') |>
  pull(WinPercentage)

claySummary <- summary(cWPercentage)
hardSummary <- summary(hWPercentage)
grassSummary <- summary(gWPercentage)

claySummary
grassSummary
hardSummary
```

```{r}
# atp box plot
atp |>
  ggplot(aes(x = Surface,
             y = WinPercentage,
             fill = Surface)) +
  stat_boxplot(geom = 'errorbar') +
  geom_boxplot(alpha = 0.5) +
  theme_minimal() +
  labs(y = "Win Percentage",
       title = "Box Plots of Win Percentages by Surface",
       caption = "ATP") +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(face = "bold",
                                    size = 20))
```

```{r}
wta <- read_csv(here::here("esselt21/tennis_module/data_repo/new_wta.csv"))
```

```{r}
names <-
  wta |>
  group_by(Player) |>
  summarise(n = n()) |>
  filter(n == 3) |>
  pull(Player) 

wta <-
  wta |>
  filter(Surface != "All") |>
  filter(Player %in% names)
```

```{r}
wta |>
  ggplot(aes(x = Surface,
             y = WinPercentage,
             fill = Surface)) +
  stat_boxplot(geom = 'errorbar') +
  geom_boxplot() +
  theme_minimal() +
  labs(y = "Win Percentage",
       title = "Box Plots of Win Percentages by Surface",
       caption = "WTA") +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(face = "bold",
                                    size = 20))
```


```{r}
library(broom)
# regression test to see difference
model <- lm(WinPercentage ~ Surface:Matches + EloRank + ReturnPointsWonPercentage + AcesPerDoubleFault,
            data = atp)
summary(model)
aug <-
  augment(model)
```

```{r}
# plotting regression model
aug |>
  ggplot(aes(x = Matches,
             y = .fitted,
             colour = Surface)) +
  geom_smooth(method = "lm",
              se = TRUE,
              aes(fill = Surface),
              linewidth = 1.25,
              alpha = 0.2) +
  geom_jitter(data = atp,
             aes(x = Matches,
                 y = WinPercentage),
             alpha = 0.4) +
  theme_minimal() +
  labs(y = 'Win Percentage',
       x = 'Number of Matches',
       title = 'Predictions vs. Actual Values of Win Percentages') +
  facet_wrap(~Surface,
             scales = "free_x") +
  theme(plot.background = element_rect(fill = "ivory"),
        panel.border = element_rect(color = "black", 
                                    fill = NA, 
                                    size = 1), 
        strip.background = element_rect(color = "black", 
                                        fill = "ivory",
                                        size = 1),
        strip.text = element_text(size = 15))
```

```{r}
# does this meet the assumptions for a multiple linear regression model?
plot(model)
```

