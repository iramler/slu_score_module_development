---
title: "tennis-testing"
author: "eric seltzer"
format: html
---

```{r}
library(tidyverse)
library(ggplot2)
library(broom)
library(modelr)
```

```{r}
tennis <- read_csv(here::here("esselt21/tennis_module/exploration/tennis.csv"))
```

```{r}
tennis <-
  tennis |>
  filter(Surface != "All") |>
  select(c(Player, Surface, EloRank, WinPercentage, DoubleFaultPercentage, ReturnPointsWonPercentage)) |>
  mutate(Surface = as_factor(Surface))
```

```{r}
# check win percentage distribution, what is the shape, center, and spread
tennis |>
  ggplot(aes(x = WinPercentage)) +
  geom_histogram(colour = "black",
                 fill = "lightblue",
                 bins = 23,
                 aes(y=..density..)) +
  theme_minimal() +
  labs(x = "Win Percentage",
       title = "Histogram of Win Percentages by Surface") +
  facet_grid(~Surface,
             scales = "free") +
  theme(
    axis.text.x = element_text(angle = 45,
                                   hjust = 1,
                                   vjust = 1)
  )
```

```{r}
# five number summary and standard deviation
wPercentage <-
  tennis |>
  pull(WinPercentage)

summary(wPercentage)
sd(wPercentage)
```

```{r}
# approximate the median, iqr, and range for each surface
tennis |>
  ggplot(aes(x = Surface,
             y = WinPercentage,
             fill = Surface)) +
  stat_boxplot(geom = 'errorbar') +
  geom_boxplot() +
  theme_minimal() +
  labs(y = "Win Percentage",
       title = "Box Plots of Win Percentages by Surface") +
  theme(legend.position = "none")
```

```{r}
# regression test to see difference
model <- lm(WinPercentage ~ Surface + ReturnPointsWonPercentage + EloRank,
            data = tennis)

summary(model)

aug <-
  augment(model)
```

```{r}
# plotting regression model
aug |>
  ggplot(aes(x = ReturnPointsWonPercentage,
             y = .fitted,
             colour = Surface)) +
  geom_smooth(method = 'lm',
              se = FALSE) +
  geom_point(data = tennis,
             aes(x = ReturnPointsWonPercentage,
                 y = WinPercentage),
             alpha = 0.4) +
  theme_minimal() +
  labs(y = 'Win Percentage',
       x = 'Return Points Won Percentage',
       title = 'Predictions vs. Actual Values of Win Percentages')
```

```{r}
# does this meet the assumptions for a multiple linear regression model?
plot(model)
```

```{r}
# look at it for top 20 ranked players
elite <-
  tennis |>
  filter(EloRank <= 20)
```

```{r}
eliteModel <- lm(WinPercentage ~ Surface + ReturnPointsWonPercentage + EloRank,
            data = elite)

summary(eliteModel)



eliteAug <-
  augment(eliteModel)
```

```{r}
# plotting regression model
eliteAug |>
  ggplot(aes(x = ReturnPointsWonPercentage,
             y = .fitted,
             colour = Surface)) +
  geom_smooth(method = 'lm',
              se = FALSE) +
  geom_point(data = elite,
             aes(x = ReturnPointsWonPercentage,
                 y = WinPercentage),
             alpha = 0.4) +
  theme_minimal() +
  labs(y = 'Win Percentage',
       x = 'Return Points Won Percentage',
       title = 'Predictions vs. Actual Values of Win Percentages',
       subtitle = 'Only top 20 ranked players included')
# talk about differences between overall and elite players
```


