<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jeffrey Merselis">

<title>Basketball Reference Score Module</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="BR_Score_files/libs/clipboard/clipboard.min.js"></script>
<script src="BR_Score_files/libs/quarto-html/quarto.js"></script>
<script src="BR_Score_files/libs/quarto-html/popper.min.js"></script>
<script src="BR_Score_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="BR_Score_files/libs/quarto-html/anchor.min.js"></script>
<link href="BR_Score_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="BR_Score_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="BR_Score_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="BR_Score_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="BR_Score_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Basketball Reference Score Module</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jeffrey Merselis </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>This QMD file explores using statistical modeling techniques to predict which NBA players are most likely to be selected to the All-NBA First Team in a given season. Using player statistics from 1980 to 2024, we will apply two models — logistic regression and random forest classification — to estimate the likelihood of each player’s selection. Logistic regression learns for binary outcomes and the models are more simple. Random forests on the other hand, are powerful ensemble models that improve prediction accuracy by combining the results of many decision trees. We’ll walk through each step of the modeling process, from data preparation and model training to evaluation and interpretation.</p>
<section id="loading-packages" class="level3">
<h3 class="anchored" data-anchor-id="loading-packages">Loading Packages</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest) <span class="co"># Used to build random forest models</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-data" class="level3">
<h3 class="anchored" data-anchor-id="loading-data">Loading Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>BR_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/Documents/Github_repos/stat_289_score/JeffreyMerselis2025/BR_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dataset-column-descriptions" class="level3">
<h3 class="anchored" data-anchor-id="dataset-column-descriptions">Dataset Column Descriptions</h3>
<ul>
<li><strong>Rk</strong>: Player’s rank that season (specific to basketball-reference.com)</li>
<li><strong>Player</strong>: Player’s full name</li>
<li><strong>Age</strong>: Player’s age during the season</li>
<li><strong>Team</strong>: Final team the player was on during the season</li>
<li><strong>Pos</strong>: Player’s listed position (e.g., PG, SF)</li>
<li><strong>G</strong>: Games played in the season</li>
<li><strong>GS</strong>: Games started in the season</li>
<li><strong>MP</strong>: Minutes played per game</li>
<li><strong>FG</strong>: Field goals made per game</li>
<li><strong>FGA</strong>: Field goals attempted per game</li>
<li><strong>FG.</strong>: Field goal percentage</li>
<li><strong>X3P</strong>: Three-pointers made per game</li>
<li><strong>X3PA</strong>: Three-pointers attempted per game</li>
<li><strong>X3P.</strong>: Three-point percentage</li>
<li><strong>X2P</strong>: Two-pointers made per game</li>
<li><strong>X2PA</strong>: Two-pointers attempted per game</li>
<li><strong>X2P.</strong>: Two-point percentage</li>
<li><strong>eFG.</strong>: Effective field goal percentage (accounts for 3-point value)</li>
<li><strong>FT</strong>: Free throws made per game</li>
<li><strong>FTA</strong>: Free throws attempted per game</li>
<li><strong>FT.</strong>: Free throw percentage</li>
<li><strong>ORB</strong>: Offensive rebounds per game</li>
<li><strong>DRB</strong>: Defensive rebounds per game</li>
<li><strong>TRB</strong>: Total rebounds per game</li>
<li><strong>AST</strong>: Assists per game</li>
<li><strong>STL</strong>: Steals per game</li>
<li><strong>BLK</strong>: Blocks per game</li>
<li><strong>TOV</strong>: Turnovers per game</li>
<li><strong>PF</strong>: Personal fouls per game</li>
<li><strong>PTS</strong>: Points per game</li>
<li><strong>Awards</strong>: List of awards (e.g., MVP, NBA1, DPOTY), blank if none</li>
<li><strong>Season</strong>: Year of the season</li>
</ul>
</section>
<section id="view-2024-all-nba-teams" class="level3">
<h3 class="anchored" data-anchor-id="view-2024-all-nba-teams">View 2024 All-NBA Teams:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>all_nba_actual_2024 <span class="ot">&lt;-</span> BR_data <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Season <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(Awards, <span class="st">"NBA1|NBA2|NBA3"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Player, Pos, Team, Awards)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>all_nba_actual_2024</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Player Pos Team                       Awards
1              Luka Dončić  PG  DAL         MVP-3,CPOY-6,AS,NBA1
2    Giannis Antetokounmpo  PF  MIL MVP-4,DPOY-9,CPOY-12,AS,NBA1
3  Shai Gilgeous-Alexander  PG  OKC  MVP-2,DPOY-7,CPOY-3,AS,NBA1
4            Jalen Brunson  PG  NYK         MVP-5,CPOY-5,AS,NBA2
5             Devin Booker  PG  PHO                      AS,NBA3
6             Kevin Durant  PF  PHO                MVP-9,AS,NBA2
7             Jayson Tatum  PF  BOS         MVP-6,CPOY-9,AS,NBA1
8            Stephen Curry  PG  GSW               CPOY-1,AS,NBA3
9             Nikola Jokić   C  DEN         MVP-1,CPOY-4,AS,NBA1
10         Anthony Edwards  SG  MIN         MVP-7,CPOY-8,AS,NBA2
11            LeBron James  PF  LAL              CPOY-10,AS,NBA3
12           Anthony Davis   C  LAL               DPOY-4,AS,NBA2
13           Kawhi Leonard  SF  LAC                      AS,NBA2
14       Tyrese Haliburton  PG  IND                      AS,NBA3
15        Domantas Sabonis   C  SAC           MVP-8,DPOY-10,NBA3</code></pre>
</div>
</div>
</section>
<section id="prepare-data" class="level3">
<h3 class="anchored" data-anchor-id="prepare-data">Prepare Data:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>all_nba_team_df <span class="ot">&lt;-</span> BR_data <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">all_nba_1st =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(Awards, <span class="st">"NBA1"</span>), <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Awards)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>numeric_data <span class="ot">&lt;-</span> all_nba_team_df <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>Rk, <span class="sc">-</span>Player, <span class="sc">-</span>Team, <span class="sc">-</span>Pos, <span class="sc">-</span>Season)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(numeric_data, <span class="at">use =</span> <span class="st">"complete.obs"</span>) </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>cor_long <span class="ot">&lt;-</span> cor_matrix <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Var1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Var1, <span class="at">names_to =</span> <span class="st">"Var2"</span>, <span class="at">values_to =</span> <span class="st">"Correlation"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cor_long, <span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> Var2, <span class="at">fill =</span> Correlation)) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BR_Score_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> all_nba_team_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(Season <span class="sc">&lt;</span> <span class="dv">2024</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> all_nba_team_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(Season <span class="sc">==</span> <span class="dv">2024</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mod_nba <span class="ot">&lt;-</span> <span class="fu">glm</span>(all_nba_1st <span class="sc">~</span> ., <span class="at">data =</span> train_data <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>Season, <span class="sc">-</span>Rk, <span class="sc">-</span>Player, <span class="sc">-</span>Team, <span class="sc">-</span>Pos),</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> binomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_nba)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = all_nba_1st ~ ., family = binomial, data = select(train_data, 
    -Season, -Rk, -Player, -Team, -Pos))

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -30.044736   6.394367  -4.699 2.62e-06 ***
Age           0.041974   0.028786   1.458  0.14480    
G            -0.000551   0.069228  -0.008  0.99365    
GS            0.075586   0.066917   1.130  0.25867    
MP           -0.043469   0.050615  -0.859  0.39044    
FG           -1.583021   3.101787  -0.510  0.60980    
FGA           2.245020   2.180712   1.029  0.30325    
FG.           6.783526  22.646926   0.300  0.76453    
X3P           0.043605   2.906254   0.015  0.98803    
X3PA         -2.416149   2.195284  -1.101  0.27107    
X3P.         -2.559626   1.249136  -2.049  0.04045 *  
X2P           0.464282   2.210310   0.210  0.83363    
X2PA         -2.331227   2.178329  -1.070  0.28453    
X2P.         -6.280234  14.653806  -0.429  0.66823    
eFG.          9.317324  22.186054   0.420  0.67451    
FT           -1.791322   1.434107  -1.249  0.21163    
FTA           1.117511   0.463005   2.414  0.01580 *  
FT.           9.556773   4.626509   2.066  0.03886 *  
ORB           1.304686   2.202256   0.592  0.55356    
DRB           1.740925   2.207366   0.789  0.43029    
TRB          -1.312435   2.205404  -0.595  0.55178    
AST           0.367131   0.068073   5.393 6.92e-08 ***
STL           1.467109   0.241509   6.075 1.24e-09 ***
BLK           0.594185   0.189520   3.135  0.00172 ** 
TOV          -0.073272   0.230386  -0.318  0.75045    
PF           -1.225423   0.227702  -5.382 7.38e-08 ***
PTS           0.921546   1.387708   0.664  0.50664    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2305.01  on 18392  degrees of freedom
Residual deviance:  717.33  on 18366  degrees of freedom
  (4797 observations deleted due to missingness)
AIC: 771.33

Number of Fisher Scoring iterations: 14</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> test_data <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions =</span> <span class="fu">predict</span>(mod_nba, <span class="at">newdata =</span> test_data, <span class="at">type =</span> <span class="st">"response"</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>best_players <span class="ot">&lt;-</span> test_data <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(predictions)) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">25</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>best_players <span class="sc">|&gt;</span> <span class="fu">select</span>(Player, Pos, predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Player Pos predictions
1              Luka Dončić  PG  0.98361795
2    Giannis Antetokounmpo  PF  0.98101650
3             Nikola Jokić   C  0.97076579
4             LeBron James  PF  0.89692011
5  Shai Gilgeous-Alexander  PG  0.87924968
6            Anthony Davis   C  0.83386662
7              Joel Embiid   C  0.71329280
8             Kevin Durant  PF  0.60004630
9             Jayson Tatum  PF  0.41061123
10           Kawhi Leonard  SF  0.37341984
11        Domantas Sabonis   C  0.32502455
12       Victor Wembanyama   C  0.29267849
13           Jalen Brunson  PG  0.27802848
14       Tyrese Haliburton  PG  0.22728145
15         Anthony Edwards  SG  0.22325796
16           Stephen Curry  PG  0.21479081
17           DeMar DeRozan  SF  0.19380379
18            De'Aaron Fox  PG  0.14826268
19        Donovan Mitchell  SG  0.12628885
20           Jarrett Allen   C  0.11532457
21          Damian Lillard  PG  0.11390647
22         Dejounte Murray  SG  0.09072274
23            Kyrie Irving  SG  0.09011407
24          Paolo Banchero  PF  0.08837307
25            Jimmy Butler  PF  0.08227116</code></pre>
</div>
</div>
</section>
<section id="random-forest" class="level1">
<h1>Random Forest</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rf_model_v1 &lt;- randomForest(</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   all_nba_1st ~ .,</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   data = train_data |&gt; select(-Season, -Rk, -Player, -Team, -Pos) |&gt; na.omit(),  </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   ntree = 500,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   importance = TRUE</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>train_med <span class="ot">&lt;-</span> train_data <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">median</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .)))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>test_med <span class="ot">&lt;-</span> test_data <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">median</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_train <span class="ot">&lt;-</span> train_med <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>Season, <span class="sc">-</span>Rk, <span class="sc">-</span>Player, <span class="sc">-</span>Team, <span class="sc">-</span>Pos, <span class="sc">-</span>all_nba_1st)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train_med<span class="sc">$</span>all_nba_1st)  <span class="co"># THIS MAKES IT CLASSIFICATION</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rf_model_v2 <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x_train,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y_train,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">500</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>test_med <span class="ot">&lt;-</span> test_med <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions =</span> <span class="fu">predict</span>(rf_model_v2, <span class="at">newdata =</span> test_med, <span class="at">type =</span> <span class="st">"prob"</span>)[,<span class="dv">2</span>])</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>top_5_rf <span class="ot">&lt;-</span> test_med <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(predictions)) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>top_5_rf <span class="sc">|&gt;</span> <span class="fu">select</span>(Player, predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Player predictions
1    Giannis Antetokounmpo       0.844
2              Luka Dončić       0.832
3             Nikola Jokić       0.794
4  Shai Gilgeous-Alexander       0.752
5             LeBron James       0.566
6              Joel Embiid       0.478
7             Kevin Durant       0.460
8            Anthony Davis       0.448
9             Jayson Tatum       0.402
10            De'Aaron Fox       0.260
11           Stephen Curry       0.252
12           Kawhi Leonard       0.236
13         Anthony Edwards       0.232
14           Jalen Brunson       0.204
15       Tyrese Haliburton       0.178</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot variable importance</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf_model_v2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BR_Score_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="evaluate-model-accuracy-confusion-matrix" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-model-accuracy-confusion-matrix">Evaluate Model Accuracy (Confusion Matrix)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix and accuracy for logistic regression</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>log_pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test_data<span class="sc">$</span>predictions <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Logistic_Predicted =</span> log_pred_class, <span class="at">Actual =</span> test_data<span class="sc">$</span>all_nba_1st)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Actual
Logistic_Predicted   0   1
                 0 635   1
                 1   4   4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix and accuracy for random forest</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>rf_pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test_med<span class="sc">$</span>predictions <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">RF_Predicted =</span> rf_pred_class, <span class="at">Actual =</span> test_med<span class="sc">$</span>all_nba_1st)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Actual
RF_Predicted   0   1
           0 730   1
           1   1   4</code></pre>
</div>
</div>
</section>
<section id="compare-top-predictions-to-actual-nba-teams" class="level3">
<h3 class="anchored" data-anchor-id="compare-top-predictions-to-actual-nba-teams">Compare Top Predictions to Actual NBA Teams</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>predicted_rf <span class="ot">&lt;-</span> top_5_rf<span class="sc">$</span>Player</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>actual_all_nba <span class="ot">&lt;-</span> all_nba_actual_2024<span class="sc">$</span>Player</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">intersect</span>(predicted_rf, actual_all_nba)       <span class="co"># correct predictions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Giannis Antetokounmpo"   "Luka Dončić"            
 [3] "Nikola Jokić"            "Shai Gilgeous-Alexander"
 [5] "LeBron James"            "Kevin Durant"           
 [7] "Anthony Davis"           "Jayson Tatum"           
 [9] "Stephen Curry"           "Kawhi Leonard"          
[11] "Anthony Edwards"         "Jalen Brunson"          
[13] "Tyrese Haliburton"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(predicted_rf, actual_all_nba)         <span class="co"># predicted but not actual (false positives)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Joel Embiid"  "De'Aaron Fox"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(actual_all_nba, predicted_rf)         <span class="co"># actual but not predicted (missed)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Devin Booker"     "Domantas Sabonis"</code></pre>
</div>
</div>
</section>
<section id="top-10-most-important-features-from-random-forest" class="level3">
<h3 class="anchored" data-anchor-id="top-10-most-important-features-from-random-forest">Top 10 Most Important Features from Random Forest</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract top 10 features by MeanDecreaseAccuracy</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>important_vars <span class="ot">&lt;-</span> <span class="fu">importance</span>(rf_model_v2) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(MeanDecreaseAccuracy)) <span class="sc">|&gt;</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>()</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>important_vars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "PF"   "X2P." "FT."  "eFG." "PTS"  "FG."  "DRB"  "AST"  "FG"   "ORB" </code></pre>
</div>
</div>
</section>
<section id="refit-random-forest-using-top-10-features" class="level3">
<h3 class="anchored" data-anchor-id="refit-random-forest-using-top-10-features">Refit Random Forest Using Top 10 Features</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset training data to only include top 10 features</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>x_train_small <span class="ot">&lt;-</span> train_med <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">all_of</span>(important_vars))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>y_train_small <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train_med<span class="sc">$</span>all_nba_1st)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Train smaller random forest model</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>rf_model_top10 <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x_train_small,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y_train_small,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">500</span>,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset test data and predict</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>x_test_small <span class="ot">&lt;-</span> test_med <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">all_of</span>(important_vars))</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>test_med <span class="ot">&lt;-</span> test_med <span class="sc">|&gt;</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_top10 =</span> <span class="fu">predict</span>(rf_model_top10, <span class="at">newdata =</span> x_test_small, <span class="at">type =</span> <span class="st">"prob"</span>)[,<span class="dv">2</span>])</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Top predictions from top-10-feature model</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>top_5_rf_top10 <span class="ot">&lt;-</span> test_med <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(predictions_top10)) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>top_5_rf_top10 <span class="sc">|&gt;</span> <span class="fu">select</span>(Player, predictions_top10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Player predictions_top10
1              Joel Embiid             0.872
2             Nikola Jokić             0.830
3              Luka Dončić             0.782
4    Giannis Antetokounmpo             0.664
5             LeBron James             0.664
6  Shai Gilgeous-Alexander             0.612
7             Jayson Tatum             0.508
8             Kevin Durant             0.374
9            Anthony Davis             0.356
10               Ja Morant             0.294
11        Domantas Sabonis             0.286
12       Tyrese Haliburton             0.280
13         Anthony Edwards             0.274
14        Donovan Mitchell             0.254
15           Kawhi Leonard             0.246</code></pre>
</div>
</div>
</section>
<section id="evaluate-top-10-feature-model-vs-full-model" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-top-10-feature-model-vs-full-model">Evaluate Top-10 Feature Model vs Full Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix for top-10-feature model</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>rf_pred_class_top10 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test_med<span class="sc">$</span>predictions_top10 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">RF_Top10_Predicted =</span> rf_pred_class_top10, <span class="at">Actual =</span> test_med<span class="sc">$</span>all_nba_1st)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Actual
RF_Top10_Predicted   0   1
                 0 729   0
                 1   2   5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare top predictions between full and reduced model</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>top_rf_full <span class="ot">&lt;-</span> top_5_rf<span class="sc">$</span>Player</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>top_rf_small <span class="ot">&lt;-</span> top_5_rf_top10<span class="sc">$</span>Player</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">intersect</span>(top_rf_full, top_rf_small)       <span class="co"># players common to both</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Giannis Antetokounmpo"   "Luka Dončić"            
 [3] "Nikola Jokić"            "Shai Gilgeous-Alexander"
 [5] "LeBron James"            "Joel Embiid"            
 [7] "Kevin Durant"            "Anthony Davis"          
 [9] "Jayson Tatum"            "Kawhi Leonard"          
[11] "Anthony Edwards"         "Tyrese Haliburton"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(top_rf_full, top_rf_small)         <span class="co"># players unique to full model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "De'Aaron Fox"  "Stephen Curry" "Jalen Brunson"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(top_rf_small, top_rf_full)         <span class="co"># players unique to top-10 model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ja Morant"        "Domantas Sabonis" "Donovan Mitchell"</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>