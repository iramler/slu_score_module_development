---
title: "Basketball Reference Score Module"
author: "Jeffrey Merselis"
format: html
editor: visual
---

# Ideas
* Predict all NBA team from season data and compare. 
  * somehow compare to all star team
* Stick with NBA vs Olympics but simpler
  * try to predict a players stats in the Olympics 
* something to do with clutch factor 
* draft steals vs busts
* best possible team from past 24 years

* add 65 game rule to past teams (introduced in 2024).
* before 2024, positional rules required two guards, two forwards, and one center per team, could look at that

# Issues
* 2025 dataset is weird bc of trades and has people listed twice

```{r}
library(tidyverse)
library(rvest)
library(shiny)
library(ggplot2)
```

```{r}
url <- "https://www.basketball-reference.com/leagues/NBA_2025_per_game.html"
page <- read_html(url)
tables <- page |> html_table(fill = TRUE)
nba_df <- tables[[1]]
nba25_df <- nba_df |> mutate(Season = 2025)
```

```{r}
all_nba_team_df <- all_seasons_data |>
  mutate(all_nba_1st = ifelse(str_detect(Awards, "NBA1"), 1, 0)) |>
  select(-Awards)
```

```{r}
# thanks chat gpt
numeric_data <- all_nba_team_df |> select(-Rk, -Player, -Team, -Pos, -Season)
cor_matrix <- cor(numeric_data, use = "complete.obs") #WHAT IS THIS??????

# Convert to long format for visualization
cor_long <- cor_matrix |> 
  as.data.frame() |> 
  rownames_to_column("Var1") |> 
  pivot_longer(-Var1, names_to = "Var2", values_to = "Correlation")

# Plot correlation matrix
ggplot(cor_long, aes(x = Var1, y = Var2, fill = Correlation)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
train_data <- all_nba_team_df |> filter(Season < 2024)
test_data <- all_nba_team_df |> filter(Season == 2024)
```

```{r}
mod_nba <- glm(all_nba_1st ~ ., data = train_data |> select(-Season, -Rk, -Player, -Team, -Pos),
            family = binomial)
summary(mod_nba)
```

```{r}
test_data <- test_data |> 
  mutate(predictions = predict(mod_nba, newdata = test_data, type = "response"))

best_players <- test_data |> arrange(desc(predictions)) |> head(25)
best_players |> select(Player, Pos, predictions)
```

```{r}
mod_nba_25 <- glm(all_nba_1st ~ ., data = all_nba_team_df |> select(-Season, -Rk, -Player, -Team, -Pos),
            family = binomial)

nba25_df <- nba25_df |> 
  mutate(predictions = predict(mod_nba_25, newdata = nba25_df, type = "response"))

best_players_25 <- nba25_df |> arrange(desc(predictions)) |> head(25)
best_players_25 |> select(Player, Pos, predictions)
```





















