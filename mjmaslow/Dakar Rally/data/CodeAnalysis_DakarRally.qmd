---
title: "Dakar Rally analysis"
author: "Matt Maslow"
format: html
---





```{r}
library(tidyverse)
```



```{r}
dakarRally_bikes_data <- read_csv("Dakar Rally/data/dakarRally_bikes_data.csv")
```


# Question 1

```{r}
dakarRally_bikes_data %>%
  filter( Stage == 6) %>%
  select(Rank, Hours, Variation_Hours, Penalty_Hours, Penalty_Minutes) %>%
  lm(Rank ~ ., data = .) %>%
  summary()

dakarRally_bikes_data %>%
  filter( Stage == 6) %>%
  select(Rank, Hours, Variation_Hours, Penalty_Hours, Penalty_Minutes) %>%
  lm(Rank ~ ., data = .) %>%
  anova()
```

## a.

```{r}
# R2 = 1 - SSE / SST
SSE = 33737
SST = (35395+50998+22590+8590+33737)

(R2 = 1 - (SSE / SST))
```

## b.

on answer key



# Question 2

```{r}
dakarRally_bikes_data <- 
  dakarRally_bikes_data %>% 
  mutate(topFive = ifelse(Rank <= 5, 1, 0))
```

```{r}
modFull <- glm(topFive ~ Hours + Variation_Hours + Penalty_Hours + Penalty_Minutes + Stage,
               data = dakarRally_bikes_data, family = binomial)
summary(modFull)
```


```{r}
modRed <- glm(topFive ~  Hours + Variation_Hours +  Penalty_Hours + Stage,
              data = dakarRally_bikes_data, family = binomial)
summary(modRed)
```
```{r}
anova(modRed, modFull, test = "Chisq")
```



# Quesrtion 3 

```{r}
dakarRally_bikes_data %>%
  group_by(Country, Driver) %>%
  summarise(count = n(),
            average_Rank = mean(Rank),
            Mean_Hours_Driven = ((mean(Hours)*60 + mean(Minutes) + (mean(Seconds)/60)) / 60),
            Mean_Hours_Penalty = (mean(Penalty_Hours)*60 + mean(Penalty_Minutes) + (mean(Penalty_Seconds)/60)) / 60,
            Mean_Hours_Variation = (mean(Variation_Hours)*60 + mean(Variation_Minutes) + (mean(Variation_Seconds)/60)) / 60) %>%
  filter((count > 1)) %>%
  arrange(average_Rank) %>%
  head()
```



# viz
```{r}
dakarRally_bikes_data %>%
  group_by(Country, Driver) %>%
  summarise(count = n(),
            average_Rank = mean(Rank),
            Mean_Hours_Driven = ((mean(Hours)*60 + mean(Minutes) + (mean(Seconds)/60)) / 60),
            Mean_Hours_Penalty = (mean(Penalty_Hours)*60 + mean(Penalty_Minutes) + (mean(Penalty_Seconds)/60)) / 60,
            Mean_Hours_Variation = (mean(Variation_Hours)*60 + mean(Variation_Minutes) + (mean(Variation_Seconds)/60)) / 60) %>%
  filter((count == 13)) %>%
  arrange(desc(Mean_Hours_Driven))
```

```{r}
dakarRally_bikes_data %>%
  group_by(Country, Driver) %>%
  summarise(count = n(),
            average_Rank = mean(Rank),
            Mean_Hours_Driven = ((mean(Hours)*60 + mean(Minutes) + (mean(Seconds)/60)) / 60),
            Mean_Hours_Penalty = (mean(Penalty_Hours)*60 + mean(Penalty_Minutes) + (mean(Penalty_Seconds)/60)) / 60,
            Mean_Hours_Variation = (mean(Variation_Hours)*60 + mean(Variation_Minutes) + (mean(Variation_Seconds)/60)) / 60) %>%
  filter(count == 13) %>%
  arrange(average_Rank) %>%
  ggplot(aes(x = average_Rank, y = Mean_Hours_Variation)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  labs(title = "Average Rank vs. Mean Hours Driven + Mean Hours Penalty",
       x = "Average Rank",
       y = "Mean Hours Driven + Mean Hours Penalty") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```







